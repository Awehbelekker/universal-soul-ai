name: Build Universal Soul AI APK

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install Java
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '11'
        
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential libssl-dev libffi-dev libxml2-dev libxslt1-dev libjpeg-dev libpng-dev zlib1g-dev
        
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install buildozer cython kivy kivymd plyer pyjnius numpy pillow requests
        
    - name: Build APK
      working-directory: ./android_overlay
      run: |
        buildozer android debug
        
    - name: Upload APK artifact
      uses: actions/upload-artifact@v4
      with:
        name: universal-soul-ai-apk
        path: bin/*.apk
        
    - name: Create Release
      if: github.ref == 'refs/heads/main'
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.0.0-${{ github.run_number }}
        name: Universal Soul AI v1.0.0-${{ github.run_number }}
        body: |
          ğŸš€ Universal Soul AI - World's First 360Â° Gesture + Overlay Interface
          
          ## ğŸ¯ Revolutionary Features
          - ğŸª Persistent overlay across all Android apps
          - ğŸ‘† 8-direction 360Â° gesture navigation
          - ğŸ™ï¸ "Hey Soul" voice activation
          - ğŸ§  Context-aware intelligence
          - ğŸ”’ 100% local processing
          
          ## ğŸ“± Installation
          1. Download the APK below
          2. Enable "Unknown Sources" on Android
          3. Install and grant permissions
          4. Test the revolutionary interface!
          
          **This is the world's first 360Â° gesture + overlay AI system!** ğŸ†
        files: android_overlay/bin/*.apk
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
